(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    114813,       2713]
NotebookOptionsPosition[    113390,       2659]
NotebookOutlinePosition[    113778,       2676]
CellTagsIndexPosition[    113735,       2673]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Dynamic Models of Segregation (Schelling 1971)", "Title",
 CellChangeTimes->{{3.6296823629022264`*^9, 3.6296823674418344`*^9}}],

Cell[BoxData[
 RowBox[{"ver110", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"2016.1024", "threshold\:306e\:5b9a\:7fa9\:3092\:30e0"}], 
    "\:30fc", 
    "\:30a2\:8fd1\:508d\:5185\:306e\:540c\:8272\:30e6\:30cb\:30c3\:30c8\:5272\
\:5408\:306b\:4fee\:6b63"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.686007249802599*^9, 3.686007281517455*^9}, {
  3.6860073342455473`*^9, 3.686007356788587*^9}, {3.6862701064614573`*^9, 
  3.6862702364261894`*^9}}],

Cell[CellGroupData[{

Cell["\:4f7f\:3044\:65b9", "Section",
 CellChangeTimes->{3.6862709019711585`*^9}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
   "1.", "Module", "\:3000", "\:30bb\:30eb\:3092\:8aad\:307f\:8fbc\:3080"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"2.", "\:8a55\:4fa1"}], "\[RightArrow]", 
    "\:52d5\:7684\:66f4\:65b0\:306e\:5b9f\:884c\:306b\:30c1\:30a7\:30c3\:30af\
\:3092\:5165\:308c\:308b"}], "\[IndentingNewLine]", 
   RowBox[{
   "3.", "Manipulate", "\:3000", 
    "\:30bb\:30eb\:3092\:8aad\:307f\:8fbc\:3080"}], "\[IndentingNewLine]", 
   RowBox[{"4.", "reset\:30dc\:30bf\:30f3\:3092\:62bc\:3059"}], 
   "\[IndentingNewLine]", 
   RowBox[{
   "5.", "run", " ", 
    "simulation\:306e\:30c1\:30a7\:30c3\:30af\:30dc\:30c3\:30af\:30b9\:3092\
on"}], "\[IndentingNewLine]", 
   RowBox[{"6.", "\:7d42\:4e86\:3059\:308b\:3068", " ", 
    RowBox[{"END", "!!"}], " ", 
    "\:304c\:51fa\:3066\:81ea\:52d5\:7684\:306b\:505c\:6b62\:3059\:308b"}], 
   "\[IndentingNewLine]", 
   RowBox[{"7.", 
    RowBox[{
    "\:6761\:4ef6\:3092\:5909\:3048\:30664", ".", 
     "\:304b\:3089\:7e70\:308a\:8fd4\:3057"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.6862707146762295`*^9, 3.686270928241605*^9}, {
  3.686270991749316*^9, 3.686270998909729*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Module", "Section",
 CellChangeTimes->{{3.492216244171875*^9, 3.492216250109375*^9}, {
  3.626486555789292*^9, 3.6264865572192936`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"\:8d64agent", " ", "\:9752agent\:306e\:521d\:671f\:914d\:7f6e"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"initialset", "[", 
      RowBox[{"size_", ",", "redn_", ",", "bluen_"}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a", ",", "b", ",", 
         RowBox[{"n", "=", 
          RowBox[{"redn", "+", "bluen"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Developer`ToPackedArray", "[", 
        RowBox[{
        "(*", " ", "Integer\:578b\:6307\:5b9a\:3067\:9ad8\:901f\:5316", " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"RandomSample", "[", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"size", "*", "size"}], "]"}], ",", "n"}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "\:7dcf\:30a8", "\:30fc", 
            "\:30b8\:30a7\:30f3\:30c8\:6570\:3060\:30511\:6b21\:5143\:914d\
\:5217\:304b\:3089\:975e\:5fa9\:5143\:62bd\:51fa"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"b", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"i", ",", "j"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "size"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", "size"}], "}"}]}], "]"}], ",", 
             "1"}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"2", "\:6b21\:5143\:5ea7\:6a19"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "\:62bd\:51fa\:3057\:305f1\:6b21\:5143\:914d\:5217\:756a\:53f7\
\:3092\:5ea7\:6a19\:306b\:5909\:63db\:3059\:308b", "\:ff0e", "\:3000", 
            "\:524d\:534a\:306f\:8d64", "\:ff0c", 
            "\:5f8c\:534a\:306f\:9752\:7528"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"b", "\[LeftDoubleBracket]", 
               RowBox[{
               "a", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "\[RightDoubleBracket]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "redn"}], "}"}]}], "]"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"b", "\[LeftDoubleBracket]", 
               RowBox[{
               "a", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "\[RightDoubleBracket]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"redn", "+", "1"}], ",", "n"}], "}"}]}], "]"}]}], 
           "}"}]}], ",", "Integer"}], "]"}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "\:975e\:5fa9\:5143\:62bd\:51fa\:3067\:521d\:671f\:914d\:7f6e\:3092\:4e0e\
\:3048\:308b", "\:ff0e", "\[IndentingNewLine]", 
     RowBox[{"output", ":", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "\:8d64\:306e\:4f4d\:7f6e\:60c5\:5831", "}"}], "\:ff0c", 
         RowBox[{"{", "\:9752\:306e\:4f4d\:7f6e\:60c5\:5831", "}"}]}], "}"}], 
       " ", "\:306e\:9806\:3067\:51fa\:529b\:3059\:308b", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"initialset", "[", 
         RowBox[{"size", ",", "redn", ",", "bluen"}], "]"}], 
        "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
       "\:8d64\:521d\:671f\:914d\:7f6e", "\:3000\:3000", 
       RowBox[{
        RowBox[{"initialset", "[", 
         RowBox[{"size", ",", "redn", ",", "bluen"}], "]"}], 
        "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "\:3000", 
       "\:9752\:521d\:671f\:914d\:7f6e"}]}]}], "\:3000\:3000", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\:521d\:671f\:30b0\:30ea\:30c3\:30c9", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zerogrid", "[", "size_", "]"}], ":=", 
    RowBox[{"Table", "[", 
     RowBox[{"0", ",", 
      RowBox[{"{", "size", "}"}], ",", 
      RowBox[{"{", "size", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "  ", 
    RowBox[{
    "agent\:306e\:4f4d\:7f6e\:60c5\:5831\:3092\:691c\:7d22\:3057\:3066", 
     "\:ff0c", "\:53ef\:8996\:5316\:3059\:308b\:95a2\:6570"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"visualize", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"redposi_", ",", "blueposi_"}], "}"}], ",", "size_"}], "]"}], 
     ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"zero1", "=", 
         RowBox[{"zerogrid", "[", "size", "]"}]}], 
        RowBox[{"(*", "Mnipulate\:5185\:3067\:6307\:5b9a", "*)"}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Embedding", " ", "agents", " ", "into", " ", "zero1", " ", "for", 
          " ", "visualization", " ", "\[IndentingNewLine]", 
          "\:5f15\:6570\:306eredposi_"}], ",", 
         RowBox[{"blueposi_\:306f\:305d\:308c\:305e\:308c", 
          RowBox[{"\:300c", "\:8d64", "\:300d"}], "\:3068", 
          RowBox[{"\:300c", "\:9752", "\:300d"}], 
          "\:306e\:73fe\:5728\:4f4d\:7f6e"}]}], "\:3000", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"zero1", "\[LeftDoubleBracket]", " ", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"redposi", "\[LeftDoubleBracket]", 
              RowBox[{"i", ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}]}],
             "\[RightDoubleBracket]"}], "=", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "redposi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"zero1", "\[LeftDoubleBracket]", " ", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"blueposi", "\[LeftDoubleBracket]", 
              RowBox[{"i", ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}]}],
             "\[RightDoubleBracket]"}], "=", "2"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "blueposi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ArrayPlot", "[", 
         RowBox[{"zero1", ",", 
          RowBox[{"ColorFunction", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"#", "\[Equal]", "0"}], ",", "White", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"#", "==", "1"}], ",", 
                 RowBox[{"Darker", "[", "Red", "]"}], ",", 
                 RowBox[{"Darker", "[", "Blue", "]"}]}], "]"}]}], "]"}], 
             "&"}], ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"300", ",", "300"}], "}"}]}], ",", 
          RowBox[{"AspectRatio", "\[Rule]", "Automatic"}], ",", 
          RowBox[{"Frame", "\[Rule]", "False"}], ",", 
          RowBox[{"Mesh", "\[Rule]", "All"}], ",", 
          RowBox[{"Axes", "\[Rule]", "False"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "\:30c8", "\:30fc", 
     "\:30e9\:30b9\:4e0a\:306b\:914d\:7f6e\:3055\:308c\:305f\:30a8\:30b4\:306e\
\:30e0", "\:30fc", 
     "\:30a2\:8fd1\:508d\:3092\:51fa\:529b\:3059\:308b\:95a2\:6570"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"moore", "[", 
      RowBox[{"t_", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"agent", "'"}], "s", " ", "position"}], " ", "*)"}], ",", 
       "size_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"m", "=", "size"}], ",", "p1", ",", "p2", ",", "p3", ",", 
         "p6", ",", "p4", ",", "p7", ",", "p8", ",", "p9", ",", "network"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"p6", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "!=", 
              "m"}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"p9", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Which", "[", 
            RowBox[{"(*", "\:3000", 
             RowBox[{"+", 
              RowBox[{
              "-", "\:3057\:3066\:3044\:308b1\:3092\:4e00\:822c\:5316\:3059\
\:308c\:3070\:8fd1\:508d\:306e\:8ddd\:96e2\:3092\:81ea\:7531\:306b\:5b9a\:7fa9\
\:3067\:304d\:308b"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "!=",
                 "1"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "!=",
                 "m"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "==",
                 "1"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "==",
                 "m"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"m", "-", "1"}], ",", 
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}]}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "==",
                 "1"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "!=",
                 "m"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"m", "-", "1"}], ",", "1"}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "!=",
                 "1"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[Equal]", "m"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", 
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"p7", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "!=",
                 "1"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[NotEqual]", "1"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", 
                RowBox[{"-", "1"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "==",
                 "1"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[Equal]", "1"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"m", "-", "1"}], ",", 
                RowBox[{"(", 
                 RowBox[{"m", "-", "1"}], ")"}]}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "==",
                 "1"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[NotEqual]", "1"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"m", "-", "1"}], ",", 
                RowBox[{"-", "1"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "!=",
                 "1"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[Equal]", "1"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", 
                RowBox[{"(", 
                 RowBox[{"m", "-", "1"}], ")"}]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"p3", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[NotEqual]", "m"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "!=",
                 "m"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"1", ",", "1"}], "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[Equal]", "m"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "==",
                 "m"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}], ",", 
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}]}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[Equal]", "m"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "!=",
                 "m"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}], ",", "1"}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[NotEqual]", "m"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[Equal]", "m"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"1", ",", 
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"p1", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[NotEqual]", "m"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[NotEqual]", "1"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"1", ",", 
                RowBox[{"-", "1"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[Equal]", "m"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[Equal]", "1"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}], ",", 
                RowBox[{"(", 
                 RowBox[{"m", "-", "1"}], ")"}]}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[Equal]", "m"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[NotEqual]", "1"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}], ",", 
                RowBox[{"-", "1"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "\[NotEqual]", "m"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "\[Equal]", "1"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"1", ",", 
                RowBox[{"(", 
                 RowBox[{"m", "-", "1"}], ")"}]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"p4", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "!=", 
              "1"}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"-", "1"}]}], "}"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"(", 
                 RowBox[{"m", "-", "1"}], ")"}]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"p2", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "\[NotEqual]", "m"}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"(", 
                  RowBox[{"m", "-", "1"}], ")"}]}], ",", "0"}], "}"}]}]}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"p8", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "\[NotEqual]", "1"}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "0"}], "}"}]}], ",", 
             RowBox[{
              RowBox[{
              "t", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"m", "-", "1"}], ")"}], ",", "0"}], "}"}]}]}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"network", "=", 
         RowBox[{"Developer`ToPackedArray", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
               "p6", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
               "p4", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
               "p2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
               "p8", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
               "p9", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
               "p7", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
               "p3", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
               "p1", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}],
               "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "[", "t", "]"}]}], "}"}]}], "]"}], ",", 
           "Integer"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", "\:3000", 
    RowBox[{"\:30e0", "\:30fc", 
     RowBox[{
     "\:30a2\:8fd1\:508d\:60c5\:5831\:306b\:57fa\:3065\:304d\:5e78\:798f\:5ea6\
", 
      RowBox[{"\:ff08", 
       RowBox[{
       "\:30e0", "\:30fc", "\:30a2\:8fd1\:508d\:5185\:306e\:540c\:8272\:30a8",
         "\:30fc", "\:30b8\:30a7\:30f3\:30c8\:5272\:5408"}], "\:ff09"}], 
      "\:3092\:8a08\:7b97"}], ",", "\:3000", 
     RowBox[{
     "\:4f4d\:7f6e\:60c5\:5831\:306b\:5e78\:798f\:5ea6\:3092\:8ffd\:52a0", 
      "\:3000\:3000", "\[IndentingNewLine]", "\:5f15\:6570", " ", 
      "agentposi\:306f\:5358\:8272\:30a8"}], "\:30fc", 
     "\:30b8\:30a7\:30f3\:30c8"}], "\:3000", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"happy", "[", 
      RowBox[{"agentposi_", ",", "size_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"neloca", ",", "happy3"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"neloca", "=", 
         RowBox[{"moore", "[", 
          RowBox[{"agentposi", ",", "size"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"happy3", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Plus", "@@", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"agentposi", ",", 
                  RowBox[{
                   RowBox[{
                   "neloca", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}]}], "]"}], ",", "1", ",", "0"}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "8"}], "}"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "neloca", "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"happy3", "=", 
         RowBox[{"happy3", "/", "8"}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{
         "\:540c\:8272\:30a8", "\:30fc", 
          "\:30b8\:30a7\:30f3\:30c8\:6570\:3092"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Append", "[", 
           RowBox[{
            RowBox[{
            "agentposi", "\[LeftDoubleBracket]", "i", 
             "\[RightDoubleBracket]"}], ",", 
            RowBox[{
            "happy3", "\[LeftDoubleBracket]", "i", 
             "\[RightDoubleBracket]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "agentposi", "]"}]}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"\:5165\:529b\:306f", "  ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}]}], "}"}], "\:3000", 
      "\:306e\:3088\:3046\:306a\:5358\:8272\:30a8"}], "\:30fc", 
     "\:30b8\:30a7\:30f3\:30c8\:306e\:4f4d\:7f6e\:60c5\:5831", "\:ff0e", 
     RowBox[{
      RowBox[{"\:51fa\:529b\:306f", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "1", ",", "0.2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1", ",", "0.3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "1", ",", "0.8"}], "}"}]}], "}"}], 
       "\[IndentingNewLine]", "\:306e\:3088\:3046\:306a", "\:3000", 
       "\:4f4d\:7f6e\:60c5\:5831"}], "+", "\:5e78\:798f\:5ea6"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "\:5e78\:798f\:60c5\:5831\:306b\:57fa\:3065\:304d", "\:ff0c", 
      "\:79fb\:52d5\:3059\:308b"}], "\:3000", 
     "visualize\:306e\:5f15\:6570\:3092\:751f\:6210\:3059\:308b"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"move", "[", 
      RowBox[{"agents_", ",", "size_", ",", "redth_", ",", "blueth_", ",", 
       StyleBox[
        RowBox[{"movern", 
         StyleBox["_",
          FontWeight->"Plain"]}]]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "preloca", ",", "zerolocate", ",", "red0", ",", "blue0", ",", "red1", 
         ",", "blue1", ",", "k1", ",", "k2", ",", "AllocationforRed", ",", 
         "l1", ",", "l2", ",", "AllocationforBlue"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"red0", "=", 
         RowBox[{
         "agents", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
        ";", 
        RowBox[{"blue0", "=", 
         RowBox[{
         "agents", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"red1", "=", 
         RowBox[{"happy", "[", 
          RowBox[{"red0", ",", "size"}], "]"}]}], ";", 
        RowBox[{"blue1", "=", 
         RowBox[{"happy", "[", 
          RowBox[{"blue0", ",", "size"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"preloca", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"red0", ",", "blue0"}], "}"}], ",", "1"}], "]"}]}], ";", 
        RowBox[{
        "(*", " ", "\:57cb\:307e\:3063\:3066\:3044\:308b\:30bb\:30eb", " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"zerolocate", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Tuples", "[", 
            RowBox[{
             RowBox[{"Range", "[", "size", "]"}], ",", "2"}], "]"}], ",", 
           "preloca"}], "]"}]}], ";", 
        RowBox[{
        "(*", "\:30bc\:30ed\:30bb\:30eb\:306e\:756a\:5730\:30ea\:30b9\:30c8", 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "red", " ", 
          "agent\:304b\:3089movern\:4eba\:3092\:9078\:3073\:52d5\:304b\:3059",
           "*", "\:975e\:5fa9\:5143\:62bd\:51fa", "*"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"k1", "=", 
         RowBox[{"RandomSample", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "red0", "]"}], "]"}], ",", "movern"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"k2", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"k1", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"red1", "\[LeftDoubleBracket]", 
              RowBox[{"#", ",", "3"}], "\[RightDoubleBracket]"}], "<", 
             "redth"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AllocationforRed", "=", 
         RowBox[{"RandomSample", "[", 
          RowBox[{"zerolocate", ",", 
           RowBox[{"Length", "[", "k2", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "red", "\[LeftDoubleBracket]", "k2", "\[RightDoubleBracket]"}], "=", 
         "AllocationforRed"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Blue", " ", 
          "agent\:304b\:3089movern\:4eba\:3092\:9078\:3073\:52d5\:304b\:3059",
           "*", "\:975e\:5fa9\:5143\:62bd\:51fa", "*"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"l1", "=", 
         RowBox[{"RandomSample", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "blue0", "]"}], "]"}], ",", "movern"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"l2", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"l1", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"blue1", "\[LeftDoubleBracket]", 
              RowBox[{"#", ",", "3"}], "\[RightDoubleBracket]"}], "<", 
             "blueth"}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AllocationforBlue", "=", 
         RowBox[{"RandomSample", "[", 
          RowBox[{
           RowBox[{"Complement", "[", 
            RowBox[{"zerolocate", ",", "AllocationforRed"}], "]"}], ",", 
           RowBox[{"Length", "[", "l2", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "blue", "\[LeftDoubleBracket]", "l2", "\[RightDoubleBracket]"}], "=",
          "AllocationforBlue"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"red", ",", "blue"}], "}"}]}]}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.492226645359375*^9, 3.4922266831875*^9}, {
   3.492226827640625*^9, 3.49222685671875*^9}, {3.492226908609375*^9, 
   3.4922270010625*^9}, {3.492227072765625*^9, 3.4922271346875*^9}, {
   3.492227189046875*^9, 3.492227192703125*^9}, {3.4922272353125*^9, 
   3.49222726778125*^9}, 3.492227377859375*^9, {3.492227470765625*^9, 
   3.492227768734375*^9}, 3.4922278141875*^9, {3.492227884546875*^9, 
   3.492227893609375*^9}, {3.4922279591875*^9, 3.492227964859375*^9}, {
   3.492228036453125*^9, 3.492228053421875*^9}, {3.4922281615*^9, 
   3.49222823009375*^9}, {3.4922285578125*^9, 3.492228585390625*^9}, {
   3.49222861990625*^9, 3.4922286325625*^9}, {3.492228674734375*^9, 
   3.492228742578125*^9}, {3.492233647703125*^9, 3.492233649125*^9}, {
   3.492234562265625*^9, 3.492234669125*^9}, {3.4922347275625*^9, 
   3.492234745015625*^9}, {3.492234901765625*^9, 3.492234916640625*^9}, {
   3.492234946984375*^9, 3.492234953046875*^9}, {3.492234995328125*^9, 
   3.49223501925*^9}, {3.49223508925*^9, 3.49223509703125*^9}, {
   3.492235207703125*^9, 3.492235277390625*^9}, {3.492235432890625*^9, 
   3.492235449171875*^9}, {3.492235494765625*^9, 3.4922355208125*^9}, {
   3.492239816046875*^9, 3.49223995778125*^9}, {3.4922400366875*^9, 
   3.492240215390625*^9}, {3.49224025459375*^9, 3.49224030740625*^9}, {
   3.492240704109375*^9, 3.49224076453125*^9}, {3.492240804875*^9, 
   3.492240857359375*^9}, {3.49224090775*^9, 3.49224091353125*^9}, {
   3.492240991046875*^9, 3.49224104496875*^9}, {3.492241109140625*^9, 
   3.49224122390625*^9}, {3.49224168265625*^9, 3.4922419478125*^9}, {
   3.4922421645625*^9, 3.49224217475*^9}, {3.49224227034375*^9, 
   3.492242273703125*^9}, {3.492242340984375*^9, 3.492242346484375*^9}, {
   3.4922424394375*^9, 3.492242599109375*^9}, {3.492242648703125*^9, 
   3.49224265003125*^9}, {3.492242695078125*^9, 3.492242722078125*^9}, {
   3.492242758015625*^9, 3.492242766875*^9}, {3.492242838671875*^9, 
   3.492242933265625*^9}, {3.4922436139375*^9, 3.49224370409375*^9}, {
   3.492243930453125*^9, 3.492243932625*^9}, {3.49224913325*^9, 
   3.492249153203125*^9}, {3.4922492448125*^9, 3.492249246296875*^9}, {
   3.49225194009375*^9, 3.49225194990625*^9}, {3.49225202528125*^9, 
   3.49225223734375*^9}, {3.49225322125*^9, 3.49225322140625*^9}, 
   3.492253252609375*^9, {3.4923107662959375`*^9, 3.4923107755615625`*^9}, {
   3.4935098986957893`*^9, 3.4935100413364143`*^9}, {3.4935150376020393`*^9, 
   3.4935150411645393`*^9}, {3.5018898119375*^9, 3.50188981915625*^9}, {
   3.50188997890625*^9, 3.50188998325*^9}, {3.6192392941368246`*^9, 
   3.61923932184941*^9}, {3.6192395763229647`*^9, 3.619239627409887*^9}, {
   3.61924164821247*^9, 3.6192416683116198`*^9}, {3.619304939191763*^9, 
   3.6193049512973843`*^9}, {3.6193050137598934`*^9, 3.619305016879899*^9}, {
   3.619305134800506*^9, 3.6193051703841686`*^9}, {3.619305249757108*^9, 
   3.619305257650722*^9}, {3.6193055596828527`*^9, 3.6193055900249057`*^9}, {
   3.619305643096199*^9, 3.61930564930501*^9}, {3.619305862370184*^9, 
   3.6193058676429935`*^9}, {3.619305927203898*^9, 3.6193059286235003`*^9}, {
   3.6193059634115615`*^9, 3.6193059646751637`*^9}, {3.6193111887990093`*^9, 
   3.6193111913418136`*^9}, {3.619311793223071*^9, 3.619311833814342*^9}, {
   3.6193118755912156`*^9, 3.619311891409643*^9}, {3.6193119302849116`*^9, 
   3.6193121113388295`*^9}, {3.619312903774899*^9, 3.619312905568902*^9}, {
   3.619313062598778*^9, 3.619313068448788*^9}, {3.6193149512806954`*^9, 
   3.619315002199185*^9}, {3.686007695527582*^9, 3.6860077139980145`*^9}, {
   3.6860078461614466`*^9, 3.6860078999659414`*^9}, {3.6860102838853292`*^9, 
   3.686010421742771*^9}, {3.686010476951268*^9, 3.6860104994153075`*^9}, {
   3.6860127613226805`*^9, 3.6860127666509852`*^9}, 3.686275083874486*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Manipulate", "Section",
 CellChangeTimes->{{3.619313962237958*^9, 3.6193139708803735`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "  ", 
   RowBox[{
    RowBox[{
    "ver090", ":", "\:81ea\:52d5\:505c\:6b62\:6a5f\:80fd\:3092\:8ffd\:52a0"}],
     "\:ff0c", 
    RowBox[{
    "happy", " ", "level", " ", 
     "\:30e2\:30cb\:30bf\:30ea\:30f3\:30b0\:3092Dynamic\:8ffd\:52a0"}]}], " ",
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Refresh", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{"moving", ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"red", ",", "blue"}], "}"}], "=", 
          RowBox[{"move", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"red", ",", "blue"}], "}"}], ",", "s", ",", "redth", ",",
             "blueth", ",", "nomove"}], "]"}]}]}], "]"}], 
       RowBox[{
       "(*", " ", "\:66f4\:65b0\:3057\:3066\:3044\:308b\:90e8\:5206", " ", 
        "*)"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"happy", "[", 
               RowBox[{"red", ",", "s"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], ">=",
             "redth"}], ")"}], "&&", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"happy", "[", 
               RowBox[{"blue", ",", "s"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], 
            "\[GreaterEqual]", "blueth"}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"moving", "=", "False"}], ";", "\[IndentingNewLine]", 
          RowBox[{"state", "=", 
           RowBox[{"Text", "[", 
            RowBox[{"Style", "[", 
             RowBox[{"\"\<END !\>\"", ",", "Red", ",", "20"}], "]"}], 
            "]"}]}]}], ",", 
         RowBox[{"moving", "=", "moving"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"state2", "=", 
        RowBox[{
         RowBox[{"Mean", "[", 
          RowBox[{
           RowBox[{"happy", "[", 
            RowBox[{"red", ",", "s"}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], "//", 
         "N"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"state3", "=", 
        RowBox[{
         RowBox[{"Mean", "[", 
          RowBox[{
           RowBox[{"happy", "[", 
            RowBox[{"blue", ",", "s"}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], "//", 
         "N"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"agent", "'"}], "s", " ", "happy", " ", "\:3092", " ", 
          "\:76e3\:8996\:3057\:3066"}], "\:ff0c", 
         RowBox[{
         "\:5168\:54e1\:304c\:6e80\:8db3\:3057\:305f\:3089moving", " ", 
          "\:3092False\:306b\:5207\:308a\:66ff\:3048"}], ",", 
         RowBox[{
          RowBox[{"Dynamic", "[", "state", "]"}], 
          "\:8868\:793a\:3092end\:306b\:5909\:3048\:308b"}], "\:ff0e", 
         "\[IndentingNewLine]", 
         RowBox[{
         "moving", " ", "\:306e\:5024\:304cFalse\:306b\:306a\:308b\:3068", 
          "\:3000", 
          RowBox[{"{", 
           RowBox[{"red", ",", "blue"}], "}"}], 
          "\:306e\:66f4\:65b0\:304c\:7d42\:308f\:308a"}], "\:ff0c", 
         RowBox[{
         "\"\<run simulation\>\"", 
          "\:30c1\:30a7\:30c3\:30af\:30dc\:30c3\:30af\:30b9\:304coff\:306b\
\:306a\:308b"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"visualize", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"red", ",", "blue"}], "}"}], ",", "s"}], "]"}]}], ",", 
      RowBox[{"UpdateInterval", "\[Rule]", 
       RowBox[{"If", "[", 
        RowBox[{"moving", ",", "0", ",", "Infinity"}], "]"}]}]}], "]"}], 
    RowBox[{"(*", " ", 
     RowBox[{"reflesh", " ", "end"}], " ", "*)"}], ",", "\[IndentingNewLine]",
     "\[IndentingNewLine]", 
    RowBox[{
    "(*", " ", 
     "\:4ee5\:4e0b\:30b9\:30e9\:30a4\:30c0\:9818\:57df\:306e\:6307\:5b9a", 
     "\:3000 ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "20", ",", "\"\<length of a side\>\""}], "}"}], ",", 
      "10", ",", "30", ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"redn", ",", 
        RowBox[{"Floor", "[", 
         RowBox[{"2", "*", "s"}], "]"}], ",", "\"\<number of red\>\""}], 
       "}"}], ",", "1", ",", 
      RowBox[{"Floor", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"s", "*", "s"}], ")"}], "/", "2"}], "]"}], ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bluen", ",", 
        RowBox[{"Floor", "[", 
         RowBox[{"2", "*", "s"}], "]"}], ",", "\"\<number of blue\>\""}], 
       "}"}], ",", "1", ",", 
      RowBox[{"Floor", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"s", "*", "s"}], ")"}], "/", "2"}], "]"}], ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"redth", ",", "0.35", ",", "\"\<red threshold\>\""}], "}"}], 
      ",", "0", ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"blueth", ",", "0.35", ",", "\"\<blue threshold\>\""}], "}"}], 
      ",", "0", ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"nomove", ",", 
        RowBox[{"Floor", "[", 
         RowBox[{
          RowBox[{"(", "s", ")"}], "/", "5"}], "]"}], ",", 
        "\"\<number of mover\>\""}], "}"}], ",", "1", ",", 
      RowBox[{"Min", "[", 
       RowBox[{"{", 
        RowBox[{"redn", ",", "bluen"}], "}"}], "]"}], ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"moving", ",", "False", ",", "\"\<run simulation\>\""}], "}"}],
       ",", 
      RowBox[{"{", 
       RowBox[{"True", ",", " ", "False"}], "}"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Button", "[", 
     RowBox[{"\"\<reset\>\"", ",", 
      RowBox[{
       RowBox[{"moving", "=", "False"}], ";", 
       RowBox[{"state", "=", "\"\<going...\>\""}], ";", 
       RowBox[{"x", "=", 
        RowBox[{"initialset", "[", 
         RowBox[{"s", ",", "redn", ",", "bluen"}], "]"}]}], ";", 
       RowBox[{"red", "=", 
        RowBox[{"x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
        ";", 
       RowBox[{"blue", "=", 
        RowBox[{
        "x", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Dynamic", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<state=\>\"", ",", "state"}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Dynamic", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<red's mean happy= \>\"", ",", "state2"}], "}"}], "]"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"Dynamic", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<blue's mean happy= \>\"", ",", "state3"}], "}"}], "]"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"SaveDefinitions", "\[Rule]", "True"}], ",", 
    RowBox[{"TrackedSymbols", "\[RuleDelayed]", 
     RowBox[{"{", 
      RowBox[{
      "moving", ",", "red", ",", "blue", ",", "redn", ",", "bluen", ",", 
       "s"}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"SynchronousUpdating", "\[Rule]", "True"}], ",", 
    RowBox[{"ControlPlacement", "\[Rule]", "Left"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.6193173703821287`*^9, 3.6193173859353557`*^9}, 
   3.6193174238902225`*^9, {3.6193174547002764`*^9, 3.619317457445881*^9}, {
   3.619317492999544*^9, 3.619317556320055*^9}, {3.6193176038533382`*^9, 
   3.619317615054158*^9}, {3.6193176606530385`*^9, 3.619317779057246*^9}, {
   3.6193178242193255`*^9, 3.619317852985776*^9}, {3.6193180883121896`*^9, 
   3.619318138091877*^9}, {3.6252689728220644`*^9, 3.625268974722067*^9}, {
   3.6252691422623014`*^9, 3.6252691441123037`*^9}, {3.626491247400886*^9, 
   3.6264912482308874`*^9}, {3.686013378202032*^9, 3.686013409425016*^9}, {
   3.6860134602967052`*^9, 3.68601348020234*^9}, {3.6860137626252365`*^9, 
   3.6860137632024374`*^9}, {3.6860138132785254`*^9, 
   3.6860138343073626`*^9}, {3.6860139387183456`*^9, 
   3.6860139974836493`*^9}, {3.6860140309301076`*^9, 3.686014033301312*^9}, {
   3.686014073556183*^9, 3.686014074211384*^9}, {3.686014124880273*^9, 
   3.6860141386238976`*^9}, {3.686014485303306*^9, 3.686014485989707*^9}, {
   3.686014563163043*^9, 3.6860145777646685`*^9}, {3.686014703438489*^9, 
   3.6860148296427107`*^9}, {3.686014941900508*^9, 3.6860149429769096`*^9}, {
   3.6860151415350585`*^9, 3.6860151789127245`*^9}, {3.686015250018649*^9, 
   3.686015260470668*^9}, {3.686270616988858*^9, 3.686270670122551*^9}, {
   3.6862751031093197`*^9, 3.6862751290521655`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`bluen$$ = Floor[
    2 $CellContext`s$$], $CellContext`blueth$$ = 0.35, $CellContext`moving$$ =
     False, $CellContext`nomove$$ = 17, $CellContext`redn$$ = 
    116, $CellContext`redth$$ = 0.35, $CellContext`s$$ = 20, Typeset`show$$ = 
    True, Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"\:540d\:79f0\:672a\:5b9a\:7fa9\"", Typeset`specs$$ = {{{
       Hold[$CellContext`s$$], 20, "length of a side"}, 10, 30, 1}, {{
       Hold[$CellContext`redn$$], 
       Floor[2 $CellContext`s$$], "number of red"}, 1, 
      Dynamic[
       Floor[($CellContext`s$$ $CellContext`s$$)/2]], 1}, {{
       Hold[$CellContext`bluen$$], 
       Floor[2 $CellContext`s$$], "number of blue"}, 1, 
      Dynamic[
       Floor[($CellContext`s$$ $CellContext`s$$)/2]], 1}, {{
       Hold[$CellContext`redth$$], 0.35, "red threshold"}, 0, 1}, {{
       Hold[$CellContext`blueth$$], 0.35, "blue threshold"}, 0, 1}, {{
       Hold[$CellContext`nomove$$], 
       Floor[Rational[1, 5] $CellContext`s$$], "number of mover"}, 1, 
      Dynamic[
       Min[{$CellContext`redn$$, $CellContext`bluen$$}]], 1}, {{
       Hold[$CellContext`moving$$], False, "run simulation"}, {True, False}}, {
      Hold[
       Button[
       "reset", $CellContext`moving$$ = False; $CellContext`state = 
         "going..."; $CellContext`x = \
$CellContext`initialset[$CellContext`s$$, $CellContext`redn$$, \
$CellContext`bluen$$]; $CellContext`red = 
         Part[$CellContext`x, 1]; $CellContext`blue = Part[$CellContext`x, 2],
         ImageSize -> Medium]], Manipulate`Dump`ThisIsNotAControl}, {
      Hold[
       Dynamic[{"state=", $CellContext`state}]], 
      Manipulate`Dump`ThisIsNotAControl}, {
      Hold[
       Dynamic[{"red's mean happy= ", $CellContext`state2}]], 
      Manipulate`Dump`ThisIsNotAControl}, {
      Hold[
       Dynamic[{"blue's mean happy= ", $CellContext`state3}]], 
      Manipulate`Dump`ThisIsNotAControl}}, Typeset`size$$ = {
    450., {220., 230.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = False, $CellContext`s$629$$ = 
    0, $CellContext`redn$634$$ = 0, $CellContext`bluen$635$$ = 
    0, $CellContext`redth$636$$ = 0, $CellContext`blueth$637$$ = 
    0, $CellContext`nomove$638$$ = 0, $CellContext`moving$639$$ = False}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`bluen$$ = 
        Floor[2 $CellContext`s$$], $CellContext`blueth$$ = 
        0.35, $CellContext`moving$$ = False, $CellContext`nomove$$ = 
        Floor[Rational[1, 5] $CellContext`s$$], $CellContext`redn$$ = 
        Floor[2 $CellContext`s$$], $CellContext`redth$$ = 
        0.35, $CellContext`s$$ = 20}, "ControllerVariables" :> {
        Hold[$CellContext`s$$, $CellContext`s$629$$, 0], 
        Hold[$CellContext`redn$$, $CellContext`redn$634$$, 0], 
        Hold[$CellContext`bluen$$, $CellContext`bluen$635$$, 0], 
        Hold[$CellContext`redth$$, $CellContext`redth$636$$, 0], 
        Hold[$CellContext`blueth$$, $CellContext`blueth$637$$, 0], 
        Hold[$CellContext`nomove$$, $CellContext`nomove$638$$, 0], 
        Hold[$CellContext`moving$$, $CellContext`moving$639$$, False]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> 
      Refresh[If[$CellContext`moving$$, {$CellContext`red, $CellContext`blue} = \
$CellContext`move[{$CellContext`red, $CellContext`blue}, $CellContext`s$$, \
$CellContext`redth$$, $CellContext`blueth$$, $CellContext`nomove$$]]; If[
          And[Min[
             Part[
              $CellContext`happy[$CellContext`red, $CellContext`s$$], All, 
              3]] >= $CellContext`redth$$, Min[
             Part[
              $CellContext`happy[$CellContext`blue, $CellContext`s$$], All, 
              3]] >= $CellContext`blueth$$], $CellContext`moving$$ = 
           False; $CellContext`state = Text[
             Style[
             "END !", Red, 
              20]], $CellContext`moving$$ = $CellContext`moving$$]; \
$CellContext`state2 = N[
           Mean[
            Part[
             $CellContext`happy[$CellContext`red, $CellContext`s$$], All, 
             3]]]; $CellContext`state3 = N[
           Mean[
            Part[
             $CellContext`happy[$CellContext`blue, $CellContext`s$$], All, 
             3]]]; $CellContext`visualize[{$CellContext`red, \
$CellContext`blue}, $CellContext`s$$], UpdateInterval -> 
        If[$CellContext`moving$$, 0, Infinity]], 
      "Specifications" :> {{{$CellContext`s$$, 20, "length of a side"}, 10, 
         30, 1, ImageSize -> Tiny, Appearance -> 
         "Labeled"}, {{$CellContext`redn$$, 
          Floor[2 $CellContext`s$$], "number of red"}, 1, 
         Dynamic[
          Floor[($CellContext`s$$ $CellContext`s$$)/2]], 1, ImageSize -> Tiny,
          Appearance -> "Labeled"}, {{$CellContext`bluen$$, 
          Floor[2 $CellContext`s$$], "number of blue"}, 1, 
         Dynamic[
          Floor[($CellContext`s$$ $CellContext`s$$)/2]], 1, ImageSize -> Tiny,
          Appearance -> 
         "Labeled"}, {{$CellContext`redth$$, 0.35, "red threshold"}, 0, 1, 
         ImageSize -> Tiny, Appearance -> 
         "Labeled"}, {{$CellContext`blueth$$, 0.35, "blue threshold"}, 0, 1, 
         ImageSize -> Tiny, Appearance -> "Labeled"}, {{$CellContext`nomove$$, 
          Floor[Rational[1, 5] $CellContext`s$$], "number of mover"}, 1, 
         Dynamic[
          Min[{$CellContext`redn$$, $CellContext`bluen$$}]], 1, ImageSize -> 
         Tiny, Appearance -> 
         "Labeled"}, {{$CellContext`moving$$, False, "run simulation"}, {
         True, False}}, 
        Button[
        "reset", $CellContext`moving$$ = False; $CellContext`state = 
          
          "going..."; $CellContext`x = \
$CellContext`initialset[$CellContext`s$$, $CellContext`redn$$, \
$CellContext`bluen$$]; $CellContext`red = 
          Part[$CellContext`x, 1]; $CellContext`blue = 
          Part[$CellContext`x, 2], ImageSize -> Medium], 
        Dynamic[{"state=", $CellContext`state}], 
        Dynamic[{"red's mean happy= ", $CellContext`state2}], 
        Dynamic[{"blue's mean happy= ", $CellContext`state3}]}, 
      "Options" :> {
       TrackedSymbols :> {$CellContext`moving$$, $CellContext`red, \
$CellContext`blue, $CellContext`redn$$, $CellContext`bluen$$, \
$CellContext`s$$}, SynchronousUpdating -> True, ControlPlacement -> Left}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{887., {262., 271.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    Initialization:>({$CellContext`move[
         Pattern[$CellContext`agents, 
          Blank[]], 
         Pattern[$CellContext`size, 
          Blank[]], 
         Pattern[$CellContext`redth, 
          Blank[]], 
         Pattern[$CellContext`blueth, 
          Blank[]], 
         Pattern[$CellContext`movern, 
          Blank[]]] := 
       Module[{$CellContext`preloca, $CellContext`zerolocate, \
$CellContext`red0, $CellContext`blue0, $CellContext`red1, $CellContext`blue1, \
$CellContext`k1, $CellContext`k2, $CellContext`AllocationforRed, \
$CellContext`l1, $CellContext`l2, $CellContext`AllocationforBlue}, \
$CellContext`red0 = Part[$CellContext`agents, 1]; $CellContext`blue0 = 
          Part[$CellContext`agents, 
            2]; $CellContext`red1 = $CellContext`happy[$CellContext`red0, \
$CellContext`size]; $CellContext`blue1 = \
$CellContext`happy[$CellContext`blue0, $CellContext`size]; \
$CellContext`preloca = 
          Flatten[{$CellContext`red0, $CellContext`blue0}, 
            1]; $CellContext`zerolocate = Complement[
            Tuples[
             Range[$CellContext`size], 
             2], $CellContext`preloca]; $CellContext`k1 = RandomSample[
            Range[
             
             Length[$CellContext`red0]], $CellContext`movern]; \
$CellContext`k2 = 
          Select[$CellContext`k1, 
            Part[$CellContext`red1, #, 
              3] < $CellContext`redth& ]; $CellContext`AllocationforRed = 
          RandomSample[$CellContext`zerolocate, 
            Length[$CellContext`k2]]; 
         Part[$CellContext`red, $CellContext`k2] = \
$CellContext`AllocationforRed; $CellContext`l1 = RandomSample[
            Range[
             
             Length[$CellContext`blue0]], $CellContext`movern]; \
$CellContext`l2 = 
          Select[$CellContext`l1, 
            Part[$CellContext`blue1, #, 
              3] < $CellContext`blueth& ]; $CellContext`AllocationforBlue = 
          RandomSample[
            
            Complement[$CellContext`zerolocate, \
$CellContext`AllocationforRed], 
            Length[$CellContext`l2]]; 
         Part[$CellContext`blue, $CellContext`l2] = \
$CellContext`AllocationforBlue; {$CellContext`red, $CellContext`blue}], \
$CellContext`happy[
         Pattern[$CellContext`agentposi, 
          Blank[]], 
         Pattern[$CellContext`size, 
          Blank[]]] := 
       Module[{$CellContext`neloca, $CellContext`happy3}, $CellContext`neloca = \
$CellContext`moore[$CellContext`agentposi, $CellContext`size]; \
$CellContext`happy3 = Table[
            Apply[Plus, 
             Table[
              If[
               MemberQ[$CellContext`agentposi, 
                Part[
                 Part[$CellContext`neloca, $CellContext`i], $CellContext`j]], 
               1, 0], {$CellContext`j, 8}]], {$CellContext`i, 1, 
             
             Length[$CellContext`neloca]}]; $CellContext`happy3 = \
$CellContext`happy3/8; Table[
           Append[
            Part[$CellContext`agentposi, $CellContext`i], 
            Part[$CellContext`happy3, $CellContext`i]], {$CellContext`i, 
            Length[$CellContext`agentposi]}]], $CellContext`moore[
         Pattern[$CellContext`t, 
          Blank[]], 
         Pattern[$CellContext`size, 
          Blank[]]] := 
       Module[{$CellContext`m = $CellContext`size, $CellContext`p1, \
$CellContext`p2, $CellContext`p3, $CellContext`p6, $CellContext`p4, \
$CellContext`p7, $CellContext`p8, $CellContext`p9, $CellContext`network}, \
$CellContext`p6 = Table[
            If[Part[
               Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m, 
             Part[$CellContext`t, $CellContext`i] + {0, 1}, 
             Part[$CellContext`t, $CellContext`i] + {
              0, -($CellContext`m - 1)}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p9 = Table[
            Which[
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {-1, 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] == $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 
               1, -($CellContext`m - 1)}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 1, 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] == $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {-1, -($CellContext`m - 
                1)}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p7 = Table[
            Which[
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] != 1], 
             Part[$CellContext`t, $CellContext`i] + {-1, -1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] == 1], 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 
               1, $CellContext`m - 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] != 1], 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 1, -1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] == 1], 
             Part[$CellContext`t, $CellContext`i] + {-1, $CellContext`m - 
               1}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p3 = Table[
            Which[
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {1, 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] == $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 
                1), -($CellContext`m - 1)}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 1), 
               1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] == $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {
              1, -($CellContext`m - 1)}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p1 = Table[
            Which[
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] != 1], 
             Part[$CellContext`t, $CellContext`i] + {1, -1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] == 1], 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 
                1), $CellContext`m - 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] != 1], 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 
                1), -1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] == 1], 
             Part[$CellContext`t, $CellContext`i] + {
              1, $CellContext`m - 1}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p4 = Table[
            If[Part[
               Part[$CellContext`t, $CellContext`i], 2] != 1, 
             Part[$CellContext`t, $CellContext`i] + {0, -1}, 
             Part[$CellContext`t, $CellContext`i] + {
              0, $CellContext`m - 1}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p2 = Table[
            If[Part[
               Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
             Part[$CellContext`t, $CellContext`i] + {1, 0}, 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 1), 
               0}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p8 = Table[
            If[Part[
               Part[$CellContext`t, $CellContext`i], 1] != 1, 
             Part[$CellContext`t, $CellContext`i] + {-1, 0}, 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 1, 
               0}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`network = 
          Developer`ToPackedArray[
            Table[{
              Part[$CellContext`p6, $CellContext`i], 
              Part[$CellContext`p4, $CellContext`i], 
              Part[$CellContext`p2, $CellContext`i], 
              Part[$CellContext`p8, $CellContext`i], 
              Part[$CellContext`p9, $CellContext`i], 
              Part[$CellContext`p7, $CellContext`i], 
              Part[$CellContext`p3, $CellContext`i], 
              Part[$CellContext`p1, $CellContext`i]}, {$CellContext`i, 
              Length[$CellContext`t]}], Integer]], $CellContext`visualize[{
          Pattern[$CellContext`redposi, 
           Blank[]], 
          Pattern[$CellContext`blueposi, 
           Blank[]]}, 
         Pattern[$CellContext`size, 
          Blank[]]] := 
       Module[{$CellContext`zero1 = $CellContext`zerogrid[$CellContext`size]},
          Do[Part[$CellContext`zero1, 
             Apply[Sequence, 
              Part[$CellContext`redposi, $CellContext`i, {1, 2}]]] = 
           1, {$CellContext`i, 
            Length[$CellContext`redposi]}]; Do[Part[$CellContext`zero1, 
             Apply[Sequence, 
              Part[$CellContext`blueposi, $CellContext`i, {1, 2}]]] = 
           2, {$CellContext`i, 
            Length[$CellContext`blueposi]}]; 
         ArrayPlot[$CellContext`zero1, ColorFunction -> (If[# == 0, White, 
             If[# == 1, 
              Darker[Red], 
              Darker[Blue]]]& ), ColorFunctionScaling -> False, 
           ImageSize -> {300, 300}, AspectRatio -> Automatic, Frame -> False, 
           Mesh -> All, Axes -> False]], $CellContext`zerogrid[
         Pattern[$CellContext`size, 
          Blank[]]] := 
       Table[0, {$CellContext`size}, {$CellContext`size}], \
$CellContext`initialset[
         Pattern[$CellContext`size, 
          Blank[]], 
         Pattern[$CellContext`redn, 
          Blank[]], 
         Pattern[$CellContext`bluen, 
          Blank[]]] := 
       Module[{$CellContext`a, $CellContext`b, $CellContext`n = \
$CellContext`redn + $CellContext`bluen}, 
         Developer`ToPackedArray[$CellContext`a = RandomSample[
             
             Range[$CellContext`size $CellContext`size], $CellContext`n]; \
$CellContext`b = Flatten[
             
             Table[{$CellContext`i, $CellContext`j}, {$CellContext`i, 
               1, $CellContext`size}, {$CellContext`j, 1, $CellContext`size}],
              1]; {
            Table[
             Part[$CellContext`b, 
              Part[$CellContext`a, $CellContext`i]], {$CellContext`i, 
              1, $CellContext`redn}], 
            Table[
             Part[$CellContext`b, 
              
              Part[$CellContext`a, $CellContext`i]], {$CellContext`i, \
$CellContext`redn + 1, $CellContext`n}]}, Integer]]}; 
     Typeset`initDone$$ = True),
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.686270455965375*^9, 3.6862704796306167`*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{
   "length", " ", "of", " ", "a", " ", "side", " ", 
    "\:306e\:5024\:3092\:6e1b\:3089\:3059\:3068\:30a8\:30e9"}], "\:30fc", 
   "\:304c\:51fa\:308b\:304c", "\:ff0c", 
   RowBox[{
   "reset\:3092\:62bc\:305b\:3070\:554f\:984c\:306a\:3044", " ", 
    "\[IndentingNewLine]", 
    "initialset\:304c\:5b9f\:884c\:3055\:308c\:308b\:307e\:3067"}], "\:ff0c", 
   RowBox[{
   "dynamic\:304c", " ", 
    "\:524d\:306e\:5024\:3092\:53c2\:7167\:3059\:308b\:305b\:3044"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.686015294369527*^9, 3.6860153326363945`*^9}, {
  3.686015397485708*^9, 3.6860154453309927`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Manipulate 2", "Section",
 CellChangeTimes->{{3.619313962237958*^9, 3.6193139708803735`*^9}, {
  3.6862741180906076`*^9, 3.6862741186834087`*^9}}],

Cell[BoxData["\:5e78\:798f\:5ea6\:3092\:30b0\:30e9\:30d5\:3067\:30ea\:30a2\
\:30eb\:30bf\:30a4\:30e0\:306b\:66f4\:65b0"], "Input",
 CellChangeTimes->{{3.6862741257814207`*^9, 3.6862741374970417`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "  ", 
   RowBox[{
    RowBox[{"ver110", ":", 
     RowBox[{
     "\:5e78\:798f\:5ea6\:3092listplot\:3067\:30ea\:30a2\:30eb\:30bf\:30a4\
\:30e0\:306b\:66f4\:65b0", "\[IndentingNewLine]", 
      "\:81ea\:52d5\:505c\:6b62\:6a5f\:80fd\:3092\:8ffd\:52a0"}]}], "\:ff0c", 
    RowBox[{
    "happy", " ", "level", " ", 
     "\:30e2\:30cb\:30bf\:30ea\:30f3\:30b0\:3092Dynamic\:8ffd\:52a0"}]}], " ",
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Refresh", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{"moving", ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"red", ",", "blue"}], "}"}], "=", 
          RowBox[{"move", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"red", ",", "blue"}], "}"}], ",", "s", ",", "redth", ",",
             "blueth", ",", "nomove"}], "]"}]}]}], "]"}], 
       RowBox[{
       "(*", " ", "\:66f4\:65b0\:3057\:3066\:3044\:308b\:90e8\:5206", " ", 
        "*)"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"happy", "[", 
               RowBox[{"red", ",", "s"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], ">=",
             "redth"}], ")"}], "&&", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"happy", "[", 
               RowBox[{"blue", ",", "s"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], 
            "\[GreaterEqual]", "blueth"}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"moving", "=", "False"}], ";", "\[IndentingNewLine]", 
          RowBox[{"state", "=", 
           RowBox[{"Text", "[", 
            RowBox[{"Style", "[", 
             RowBox[{"\"\<END !\>\"", ",", "Red", ",", "20"}], "]"}], 
            "]"}]}]}], ",", 
         RowBox[{"moving", "=", "moving"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"state2", "=", 
        RowBox[{
         RowBox[{"Mean", "[", 
          RowBox[{
           RowBox[{"happy", "[", 
            RowBox[{"red", ",", "s"}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], "//", 
         "N"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"state3", "=", 
        RowBox[{
         RowBox[{"Mean", "[", 
          RowBox[{
           RowBox[{"happy", "[", 
            RowBox[{"blue", ",", "s"}], "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], "]"}], "//", 
         "N"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"agent", "'"}], "s", " ", "happy", " ", "\:3092", " ", 
          "\:76e3\:8996\:3057\:3066"}], "\:ff0c", 
         RowBox[{
         "\:5168\:54e1\:304c\:6e80\:8db3\:3057\:305f\:3089moving", " ", 
          "\:3092False\:306b\:5207\:308a\:66ff\:3048"}], ",", 
         RowBox[{
          RowBox[{"Dynamic", "[", "state", "]"}], 
          "\:8868\:793a\:3092end\:306b\:5909\:3048\:308b"}], "\:ff0e", 
         "\[IndentingNewLine]", 
         RowBox[{
         "moving", " ", "\:306e\:5024\:304cFalse\:306b\:306a\:308b\:3068", 
          "\:3000", 
          RowBox[{"{", 
           RowBox[{"red", ",", "blue"}], "}"}], 
          "\:306e\:66f4\:65b0\:304c\:7d42\:308f\:308a"}], "\:ff0c", 
         RowBox[{
         "\"\<run simulation\>\"", 
          "\:30c1\:30a7\:30c3\:30af\:30dc\:30c3\:30af\:30b9\:304coff\:306b\
\:306a\:308b"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"visualize", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"red", ",", "blue"}], "}"}], ",", "s"}], "]"}]}], ",", 
      RowBox[{"UpdateInterval", "\[Rule]", 
       RowBox[{"If", "[", 
        RowBox[{"moving", ",", "0.01", ",", "Infinity"}], "]"}]}]}], "]"}], 
    RowBox[{"(*", " ", 
     RowBox[{"reflesh", " ", "end"}], " ", "*)"}], ",", "\[IndentingNewLine]",
     "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "20", ",", "\"\<length of a side\>\""}], "}"}], ",", 
      "10", ",", "30", ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"redn", ",", 
        RowBox[{"Floor", "[", 
         RowBox[{"2", "*", "s"}], "]"}], ",", "\"\<number of red\>\""}], 
       "}"}], ",", "1", ",", 
      RowBox[{"Floor", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"s", "*", "s"}], ")"}], "/", "2"}], "]"}], ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bluen", ",", 
        RowBox[{"Floor", "[", 
         RowBox[{"2", "*", "s"}], "]"}], ",", "\"\<number of blue\>\""}], 
       "}"}], ",", "1", ",", 
      RowBox[{"Floor", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"s", "*", "s"}], ")"}], "/", "2"}], "]"}], ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"redth", ",", "0.35", ",", "\"\<red threshold\>\""}], "}"}], 
      ",", "0", ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"blueth", ",", "0.35", ",", "\"\<blue threshold\>\""}], "}"}], 
      ",", "0", ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"nomove", ",", 
        RowBox[{"Floor", "[", 
         RowBox[{
          RowBox[{"(", "s", ")"}], "/", "5"}], "]"}], ",", 
        "\"\<number of mover\>\""}], "}"}], ",", "1", ",", 
      RowBox[{"Min", "[", 
       RowBox[{"{", 
        RowBox[{"redn", ",", "bluen"}], "}"}], "]"}], ",", "1", ",", 
      RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
      RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"moving", ",", "False", ",", "\"\<run simulation\>\""}], "}"}],
       ",", 
      RowBox[{"{", 
       RowBox[{"True", ",", " ", "False"}], "}"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Button", "[", 
     RowBox[{"\"\<reset\>\"", ",", 
      RowBox[{
       RowBox[{"moving", "=", "False"}], ";", 
       RowBox[{"state", "=", "\"\<going...\>\""}], ";", 
       RowBox[{"x", "=", 
        RowBox[{"initialset", "[", 
         RowBox[{"s", ",", "redn", ",", "bluen"}], "]"}]}], ";", 
       RowBox[{"red", "=", 
        RowBox[{"x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
        ";", 
       RowBox[{"blue", "=", 
        RowBox[{
        "x", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Dynamic", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<state=\>\"", ",", "state"}], "}"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Dynamic", "[", 
     RowBox[{"ListPlot", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{"1", ",", "state2"}], "}"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{"2", ",", "state3"}], "}"}], "}"}]}], "}"}], ",", 
       RowBox[{"Filling", "->", "Axis"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"PlotMarkers", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Red", ",", "Blue"}], "}"}]}]}], "]"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"SaveDefinitions", "\[Rule]", "True"}], ",", 
    RowBox[{"TrackedSymbols", "\[RuleDelayed]", 
     RowBox[{"{", 
      RowBox[{
      "moving", ",", "red", ",", "blue", ",", "redn", ",", "bluen", ",", 
       "s"}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"SynchronousUpdating", "\[Rule]", "True"}], ",", 
    RowBox[{"ControlPlacement", "\[Rule]", "Left"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.686274255590249*^9, 3.6862742878355055`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`bluen$$ = Floor[
    2 $CellContext`s$$], $CellContext`blueth$$ = 0.35, $CellContext`moving$$ =
     False, $CellContext`nomove$$ = 9, $CellContext`redn$$ = Floor[
    2 $CellContext`s$$], $CellContext`redth$$ = 0.35, $CellContext`s$$ = 20, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"\:540d\:79f0\:672a\:5b9a\:7fa9\"", 
    Typeset`specs$$ = {{{
       Hold[$CellContext`s$$], 20, "length of a side"}, 10, 30, 1}, {{
       Hold[$CellContext`redn$$], 
       Floor[2 $CellContext`s$$], "number of red"}, 1, 
      Dynamic[
       Floor[($CellContext`s$$ $CellContext`s$$)/2]], 1}, {{
       Hold[$CellContext`bluen$$], 
       Floor[2 $CellContext`s$$], "number of blue"}, 1, 
      Dynamic[
       Floor[($CellContext`s$$ $CellContext`s$$)/2]], 1}, {{
       Hold[$CellContext`redth$$], 0.35, "red threshold"}, 0, 1}, {{
       Hold[$CellContext`blueth$$], 0.35, "blue threshold"}, 0, 1}, {{
       Hold[$CellContext`nomove$$], 
       Floor[Rational[1, 5] $CellContext`s$$], "number of mover"}, 1, 
      Dynamic[
       Min[{$CellContext`redn$$, $CellContext`bluen$$}]], 1}, {{
       Hold[$CellContext`moving$$], False, "run simulation"}, {True, False}}, {
      Hold[
       Button[
       "reset", $CellContext`moving$$ = False; $CellContext`state = 
         "going..."; $CellContext`x = \
$CellContext`initialset[$CellContext`s$$, $CellContext`redn$$, \
$CellContext`bluen$$]; $CellContext`red = 
         Part[$CellContext`x, 1]; $CellContext`blue = Part[$CellContext`x, 2],
         ImageSize -> Medium]], Manipulate`Dump`ThisIsNotAControl}, {
      Hold[
       Dynamic[{"state=", $CellContext`state}]], 
      Manipulate`Dump`ThisIsNotAControl}, {
      Hold[
       Dynamic[
        ListPlot[{{{1, $CellContext`state2}}, {{2, $CellContext`state3}}}, 
         Filling -> Axis, PlotRange -> {{0, 3}, {0, 1}}, 
         PlotMarkers -> {Red, Blue}]]], Manipulate`Dump`ThisIsNotAControl}}, 
    Typeset`size$$ = {450., {220., 230.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    False, $CellContext`s$888409$$ = 0, $CellContext`redn$888410$$ = 
    0, $CellContext`bluen$888411$$ = 0, $CellContext`redth$888412$$ = 
    0, $CellContext`blueth$888413$$ = 0, $CellContext`nomove$888414$$ = 
    0, $CellContext`moving$888415$$ = False}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`bluen$$ = 
        Floor[2 $CellContext`s$$], $CellContext`blueth$$ = 
        0.35, $CellContext`moving$$ = False, $CellContext`nomove$$ = 
        Floor[Rational[1, 5] $CellContext`s$$], $CellContext`redn$$ = 
        Floor[2 $CellContext`s$$], $CellContext`redth$$ = 
        0.35, $CellContext`s$$ = 20}, "ControllerVariables" :> {
        Hold[$CellContext`s$$, $CellContext`s$888409$$, 0], 
        Hold[$CellContext`redn$$, $CellContext`redn$888410$$, 0], 
        Hold[$CellContext`bluen$$, $CellContext`bluen$888411$$, 0], 
        Hold[$CellContext`redth$$, $CellContext`redth$888412$$, 0], 
        Hold[$CellContext`blueth$$, $CellContext`blueth$888413$$, 0], 
        Hold[$CellContext`nomove$$, $CellContext`nomove$888414$$, 0], 
        Hold[$CellContext`moving$$, $CellContext`moving$888415$$, False]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> 
      Refresh[If[$CellContext`moving$$, {$CellContext`red, $CellContext`blue} = \
$CellContext`move[{$CellContext`red, $CellContext`blue}, $CellContext`s$$, \
$CellContext`redth$$, $CellContext`blueth$$, $CellContext`nomove$$]]; If[
          And[Min[
             Part[
              $CellContext`happy[$CellContext`red, $CellContext`s$$], All, 
              3]] >= $CellContext`redth$$, Min[
             Part[
              $CellContext`happy[$CellContext`blue, $CellContext`s$$], All, 
              3]] >= $CellContext`blueth$$], $CellContext`moving$$ = 
           False; $CellContext`state = Text[
             Style[
             "END !", Red, 
              20]], $CellContext`moving$$ = $CellContext`moving$$]; \
$CellContext`state2 = N[
           Mean[
            Part[
             $CellContext`happy[$CellContext`red, $CellContext`s$$], All, 
             3]]]; $CellContext`state3 = N[
           Mean[
            Part[
             $CellContext`happy[$CellContext`blue, $CellContext`s$$], All, 
             3]]]; $CellContext`visualize[{$CellContext`red, \
$CellContext`blue}, $CellContext`s$$], UpdateInterval -> 
        If[$CellContext`moving$$, 0.01, Infinity]], 
      "Specifications" :> {{{$CellContext`s$$, 20, "length of a side"}, 10, 
         30, 1, ImageSize -> Tiny, Appearance -> 
         "Labeled"}, {{$CellContext`redn$$, 
          Floor[2 $CellContext`s$$], "number of red"}, 1, 
         Dynamic[
          Floor[($CellContext`s$$ $CellContext`s$$)/2]], 1, ImageSize -> Tiny,
          Appearance -> "Labeled"}, {{$CellContext`bluen$$, 
          Floor[2 $CellContext`s$$], "number of blue"}, 1, 
         Dynamic[
          Floor[($CellContext`s$$ $CellContext`s$$)/2]], 1, ImageSize -> Tiny,
          Appearance -> 
         "Labeled"}, {{$CellContext`redth$$, 0.35, "red threshold"}, 0, 1, 
         ImageSize -> Tiny, Appearance -> 
         "Labeled"}, {{$CellContext`blueth$$, 0.35, "blue threshold"}, 0, 1, 
         ImageSize -> Tiny, Appearance -> "Labeled"}, {{$CellContext`nomove$$, 
          Floor[Rational[1, 5] $CellContext`s$$], "number of mover"}, 1, 
         Dynamic[
          Min[{$CellContext`redn$$, $CellContext`bluen$$}]], 1, ImageSize -> 
         Tiny, Appearance -> 
         "Labeled"}, {{$CellContext`moving$$, False, "run simulation"}, {
         True, False}}, 
        Button[
        "reset", $CellContext`moving$$ = False; $CellContext`state = 
          "going..."; $CellContext`x = \
$CellContext`initialset[$CellContext`s$$, $CellContext`redn$$, \
$CellContext`bluen$$]; $CellContext`red = 
          Part[$CellContext`x, 1]; $CellContext`blue = 
          Part[$CellContext`x, 2], ImageSize -> Medium], 
        Dynamic[{"state=", $CellContext`state}], 
        Dynamic[
         ListPlot[{{{1, $CellContext`state2}}, {{2, $CellContext`state3}}}, 
          Filling -> Axis, PlotRange -> {{0, 3}, {0, 1}}, 
          PlotMarkers -> {Red, Blue}]]}, 
      "Options" :> {
       TrackedSymbols :> {$CellContext`moving$$, $CellContext`red, \
$CellContext`blue, $CellContext`redn$$, $CellContext`bluen$$, \
$CellContext`s$$}, SynchronousUpdating -> True, ControlPlacement -> Left}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{887., {262., 271.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    Initialization:>({$CellContext`moving$$ = False, $CellContext`red = Table[
         Part[$CellContext`b$863169, 
          Part[$CellContext`a$863169, $CellContext`i]], {$CellContext`i, 
          1, $CellContext`redn$$}], 
       Attributes[$CellContext`b$863169] = {Temporary}, $CellContext`b$863169 = 
       Table[{$CellContext`i, $CellContext`j}, {$CellContext`i, 
          1, $CellContext`s$$}, {$CellContext`j, 1, $CellContext`s$$}], 
       Attributes[$CellContext`a$863169] = {Temporary}, $CellContext`a$863169 = 
       RandomSample[
         Range[$CellContext`s$$^2], $CellContext`bluen$$ + \
$CellContext`redn$$], $CellContext`blue = Table[
         Part[$CellContext`b$863169, 
          Part[$CellContext`a$863169, $CellContext`i]], {$CellContext`i, 
          1 + $CellContext`redn$$, $CellContext`bluen$$ + \
$CellContext`redn$$}], $CellContext`move[
         Pattern[$CellContext`agents, 
          Blank[]], 
         Pattern[$CellContext`size, 
          Blank[]], 
         Pattern[$CellContext`redth, 
          Blank[]], 
         Pattern[$CellContext`blueth, 
          Blank[]], 
         Pattern[$CellContext`movern, 
          Blank[]]] := 
       Module[{$CellContext`preloca, $CellContext`zerolocate, \
$CellContext`red0, $CellContext`blue0, $CellContext`red1, $CellContext`blue1, \
$CellContext`k1, $CellContext`k2, $CellContext`AllocationforRed, \
$CellContext`l1, $CellContext`l2, $CellContext`AllocationforBlue}, \
$CellContext`red0 = Part[$CellContext`agents, 1]; $CellContext`blue0 = 
          Part[$CellContext`agents, 
            2]; $CellContext`red1 = $CellContext`happy[$CellContext`red0, \
$CellContext`size]; $CellContext`blue1 = \
$CellContext`happy[$CellContext`blue0, $CellContext`size]; \
$CellContext`preloca = 
          Flatten[{$CellContext`red0, $CellContext`blue0}, 
            1]; $CellContext`zerolocate = Complement[
            Tuples[
             Range[$CellContext`size], 
             2], $CellContext`preloca]; $CellContext`k1 = RandomSample[
            Range[
             
             Length[$CellContext`red0]], $CellContext`movern]; \
$CellContext`k2 = 
          Select[$CellContext`k1, 
            Part[$CellContext`red1, #, 
              3] < $CellContext`redth& ]; $CellContext`AllocationforRed = 
          RandomSample[$CellContext`zerolocate, 
            Length[$CellContext`k2]]; 
         Part[$CellContext`red, $CellContext`k2] = \
$CellContext`AllocationforRed; $CellContext`l1 = RandomSample[
            Range[
             
             Length[$CellContext`blue0]], $CellContext`movern]; \
$CellContext`l2 = 
          Select[$CellContext`l1, 
            Part[$CellContext`blue1, #, 
              3] < $CellContext`blueth& ]; $CellContext`AllocationforBlue = 
          RandomSample[
            
            Complement[$CellContext`zerolocate, \
$CellContext`AllocationforRed], 
            Length[$CellContext`l2]]; 
         Part[$CellContext`blue, $CellContext`l2] = \
$CellContext`AllocationforBlue; {$CellContext`red, $CellContext`blue}], \
$CellContext`happy[
         Pattern[$CellContext`agentposi, 
          Blank[]], 
         Pattern[$CellContext`size, 
          Blank[]]] := 
       Module[{$CellContext`neloca, $CellContext`happy3}, $CellContext`neloca = \
$CellContext`moore[$CellContext`agentposi, $CellContext`size]; \
$CellContext`happy3 = Table[
            Apply[Plus, 
             Table[
              If[
               MemberQ[$CellContext`agentposi, 
                Part[
                 Part[$CellContext`neloca, $CellContext`i], $CellContext`j]], 
               1, 0], {$CellContext`j, 8}]], {$CellContext`i, 1, 
             
             Length[$CellContext`neloca]}]; $CellContext`happy3 = \
$CellContext`happy3/8; Table[
           Append[
            Part[$CellContext`agentposi, $CellContext`i], 
            Part[$CellContext`happy3, $CellContext`i]], {$CellContext`i, 
            Length[$CellContext`agentposi]}]], $CellContext`moore[
         Pattern[$CellContext`t, 
          Blank[]], 
         Pattern[$CellContext`size, 
          Blank[]]] := 
       Module[{$CellContext`m = $CellContext`size, $CellContext`p1, \
$CellContext`p2, $CellContext`p3, $CellContext`p6, $CellContext`p4, \
$CellContext`p7, $CellContext`p8, $CellContext`p9, $CellContext`network}, \
$CellContext`p6 = Table[
            If[Part[
               Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m, 
             Part[$CellContext`t, $CellContext`i] + {0, 1}, 
             Part[$CellContext`t, $CellContext`i] + {
              0, -($CellContext`m - 1)}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p9 = Table[
            Which[
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {-1, 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] == $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 
               1, -($CellContext`m - 1)}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 1, 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] == $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {-1, -($CellContext`m - 
                1)}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p7 = Table[
            Which[
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] != 1], 
             Part[$CellContext`t, $CellContext`i] + {-1, -1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] == 1], 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 
               1, $CellContext`m - 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] != 1], 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 1, -1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != 1, Part[
                Part[$CellContext`t, $CellContext`i], 2] == 1], 
             Part[$CellContext`t, $CellContext`i] + {-1, $CellContext`m - 
               1}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p3 = Table[
            Which[
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {1, 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] == $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 
                1), -($CellContext`m - 1)}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] != $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 1), 
               1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] == $CellContext`m], 
             Part[$CellContext`t, $CellContext`i] + {
              1, -($CellContext`m - 1)}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p1 = Table[
            Which[
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] != 1], 
             Part[$CellContext`t, $CellContext`i] + {1, -1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] == 1], 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 
                1), $CellContext`m - 1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] == $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] != 1], 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 
                1), -1}, 
             And[Part[
                Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
              Part[
                Part[$CellContext`t, $CellContext`i], 2] == 1], 
             Part[$CellContext`t, $CellContext`i] + {
              1, $CellContext`m - 1}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p4 = Table[
            If[Part[
               Part[$CellContext`t, $CellContext`i], 2] != 1, 
             Part[$CellContext`t, $CellContext`i] + {0, -1}, 
             Part[$CellContext`t, $CellContext`i] + {
              0, $CellContext`m - 1}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p2 = Table[
            If[Part[
               Part[$CellContext`t, $CellContext`i], 1] != $CellContext`m, 
             Part[$CellContext`t, $CellContext`i] + {1, 0}, 
             Part[$CellContext`t, $CellContext`i] + {-($CellContext`m - 1), 
               0}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`p8 = Table[
            If[Part[
               Part[$CellContext`t, $CellContext`i], 1] != 1, 
             Part[$CellContext`t, $CellContext`i] + {-1, 0}, 
             Part[$CellContext`t, $CellContext`i] + {$CellContext`m - 1, 
               0}], {$CellContext`i, 
             Length[$CellContext`t]}]; $CellContext`network = 
          Developer`ToPackedArray[
            Table[{
              Part[$CellContext`p6, $CellContext`i], 
              Part[$CellContext`p4, $CellContext`i], 
              Part[$CellContext`p2, $CellContext`i], 
              Part[$CellContext`p8, $CellContext`i], 
              Part[$CellContext`p9, $CellContext`i], 
              Part[$CellContext`p7, $CellContext`i], 
              Part[$CellContext`p3, $CellContext`i], 
              Part[$CellContext`p1, $CellContext`i]}, {$CellContext`i, 
              Length[$CellContext`t]}], Integer]], $CellContext`state = 
       "going...", $CellContext`state2 = 
       0.5 $CellContext`redn$$, $CellContext`state3 = 
       0.5 ($CellContext`bluen$$ + $CellContext`redn$$), \
$CellContext`visualize[{
          Pattern[$CellContext`redposi, 
           Blank[]], 
          Pattern[$CellContext`blueposi, 
           Blank[]]}, 
         Pattern[$CellContext`size, 
          Blank[]]] := 
       Module[{$CellContext`zero1 = $CellContext`zerogrid[$CellContext`size]},
          Do[Part[$CellContext`zero1, 
             Apply[Sequence, 
              Part[$CellContext`redposi, $CellContext`i, {1, 2}]]] = 
           1, {$CellContext`i, 
            Length[$CellContext`redposi]}]; Do[Part[$CellContext`zero1, 
             Apply[Sequence, 
              Part[$CellContext`blueposi, $CellContext`i, {1, 2}]]] = 
           2, {$CellContext`i, 
            Length[$CellContext`blueposi]}]; 
         ArrayPlot[$CellContext`zero1, ColorFunction -> (If[# == 0, White, 
             If[# == 1, 
              Darker[Red], 
              Darker[Blue]]]& ), ColorFunctionScaling -> False, 
           ImageSize -> {300, 300}, AspectRatio -> Automatic, Frame -> False, 
           Mesh -> All, Axes -> False]], $CellContext`zerogrid[
         Pattern[$CellContext`size, 
          Blank[]]] := 
       Table[0, {$CellContext`size}, {$CellContext`size}], $CellContext`x = {
         Table[
          Part[$CellContext`b$863169, 
           Part[$CellContext`a$863169, $CellContext`i]], {$CellContext`i, 
           1, $CellContext`redn$$}], 
         Table[
          Part[$CellContext`b$863169, 
           Part[$CellContext`a$863169, $CellContext`i]], {$CellContext`i, 
           1 + $CellContext`redn$$, $CellContext`bluen$$ + \
$CellContext`redn$$}]}, $CellContext`initialset[
         Pattern[$CellContext`size, 
          Blank[]], 
         Pattern[$CellContext`redn, 
          Blank[]], 
         Pattern[$CellContext`bluen, 
          Blank[]]] := 
       Module[{$CellContext`a, $CellContext`b, $CellContext`n = \
$CellContext`redn + $CellContext`bluen}, 
         Developer`ToPackedArray[$CellContext`a = RandomSample[
             
             Range[$CellContext`size $CellContext`size], $CellContext`n]; \
$CellContext`b = Flatten[
             
             Table[{$CellContext`i, $CellContext`j}, {$CellContext`i, 
               1, $CellContext`size}, {$CellContext`j, 1, $CellContext`size}],
              1]; {
            Table[
             Part[$CellContext`b, 
              Part[$CellContext`a, $CellContext`i]], {$CellContext`i, 
              1, $CellContext`redn}], 
            Table[
             Part[$CellContext`b, 
              
              Part[$CellContext`a, $CellContext`i]], {$CellContext`i, \
$CellContext`redn + 1, $CellContext`n}]}, Integer]]}; 
     Typeset`initDone$$ = True),
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.6862741748903074`*^9, {3.6862742594434557`*^9, 3.686274288599907*^9}, 
   3.68627587746647*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["initialset[ ], visualize[ ]\:306e\:4f7f\:7528\:4f8b", "Section",
 CellChangeTimes->{
  3.6860077446988688`*^9, {3.6860080311465716`*^9, 3.6860080813006597`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"size", "=", "5"}], ",", "posi"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"posi", "=", 
      RowBox[{"initialset", "[", 
       RowBox[{"size", 
        RowBox[{"(*", "size", "*)"}], ",", "7", 
        RowBox[{"(*", "redn", "*)"}], ",", "7"}], 
       RowBox[{"(*", "bluen", "*)"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"visualize", "[", 
      RowBox[{"posi", ",", "size"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.686007754636086*^9, 3.6860077890653467`*^9}, {
  3.686007923131982*^9, 3.68600801328454*^9}, {3.686010137369872*^9, 
  3.686010138165473*^9}, {3.6860101862759576`*^9, 3.686010192047968*^9}}],

Cell[BoxData[
 GraphicsBox[{RasterBox[CompressedData["
1:eJxTTMoPSmVmYGBghWIQOxQMntozEACo6j7goElVTy1zMNXj9xemOaSGA7XM
Jy/8KXcPrWkARI9UpQ==
    "], {{0, 0}, {5, 5}}, {0, 1}], {
    {GrayLevel[
      NCache[-1 + GoldenRatio, 0.6180339887498949]], 
     StyleBox[
      LineBox[{{{0, 5}, {5, 5}}, {{0, 4}, {5, 4}}, {{0, 3}, {5, 3}}, {{0, 
       2}, {5, 2}}, {{0, 1}, {5, 1}}, {{0, 0}, {5, 0}}}],
      Antialiasing->False]}, 
    {GrayLevel[
      NCache[-1 + GoldenRatio, 0.6180339887498949]], 
     StyleBox[
      LineBox[{{{0, 0}, {0, 5}}, {{1, 0}, {1, 5}}, {{2, 0}, {2, 5}}, {{3, 
       0}, {3, 5}}, {{4, 0}, {4, 5}}, {{5, 0}, {5, 5}}}],
      Antialiasing->False]}}},
  AspectRatio->Automatic,
  Axes->False,
  Frame->False,
  FrameLabel->{None, None},
  FrameTicks->{{None, None}, {None, None}},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImageSize->{300, 300},
  Method->{
   "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
    Automatic}]], "Output",
 CellChangeTimes->{
  3.6860077935113544`*^9, {3.6860080012881193`*^9, 3.6860080139709415`*^9}, 
   3.6860101394602757`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"size", "=", "5"}], ",", "posi"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"posi", "=", 
      RowBox[{"initialset", "[", 
       RowBox[{"size", 
        RowBox[{"(*", "size", "*)"}], ",", "7", 
        RowBox[{"(*", "redn", "*)"}], ",", "7"}], 
       RowBox[{"(*", "bluen", "*)"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"x", "=", 
      RowBox[{"happy", "[", 
       RowBox[{
        RowBox[{
        "posi", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
        "size"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "x", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"visualize", "[", 
      RowBox[{"posi", ",", "size"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.686010200253582*^9, 3.686010268519302*^9}, {
  3.686012779272707*^9, 3.6860127941365576`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "4", ",", 
     FractionBox["3", "8"]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5", ",", "5", ",", 
     FractionBox["1", "4"]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3", ",", 
     FractionBox["1", "4"]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5", ",", "3", ",", 
     FractionBox["1", "2"]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "2", ",", 
     FractionBox["3", "8"]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "3", ",", 
     FractionBox["1", "4"]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "1", ",", 
     FractionBox["1", "4"]}], "}"}]}], "}"}]], "Print",
 CellChangeTimes->{3.6860127948916006`*^9}],

Cell[BoxData[
 GraphicsBox[{RasterBox[CompressedData["
1:eJxTTMoPSmVmYGBghWIQGwI+2BNLh4LBU3sGAgCmDpd6aonjV4fLH6SqJ9Uc
aplPLfcTr5688Mc0BwCKx1Sl
    "], {{0, 0}, {5, 5}}, {0, 1}], {
    {GrayLevel[
      NCache[-1 + GoldenRatio, 0.6180339887498949]], 
     StyleBox[
      LineBox[{{{0, 5}, {5, 5}}, {{0, 4}, {5, 4}}, {{0, 3}, {5, 3}}, {{0, 
       2}, {5, 2}}, {{0, 1}, {5, 1}}, {{0, 0}, {5, 0}}}],
      Antialiasing->False]}, 
    {GrayLevel[
      NCache[-1 + GoldenRatio, 0.6180339887498949]], 
     StyleBox[
      LineBox[{{{0, 0}, {0, 5}}, {{1, 0}, {1, 5}}, {{2, 0}, {2, 5}}, {{3, 
       0}, {3, 5}}, {{4, 0}, {4, 5}}, {{5, 0}, {5, 5}}}],
      Antialiasing->False]}}},
  AspectRatio->Automatic,
  Axes->False,
  Frame->False,
  FrameLabel->{None, None},
  FrameTicks->{{None, None}, {None, None}},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImageSize->{300, 300},
  Method->{
   "DefaultBoundaryStyle" -> Automatic, "DefaultPlotStyle" -> 
    Automatic}]], "Output",
 CellChangeTimes->{{3.6860127798837423`*^9, 3.686012794918602*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1906, 1352},
WindowMargins->{{46, Automatic}, {Automatic, 35}},
Magnification:>1.5 Inherited,
FrontEndVersion->"10.2 for Microsoft Windows (64-bit) (2015\:5e747\:670829\
\:65e5)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 133, 1, 123, "Title"],
Cell[716, 25, 449, 10, 43, "Input"],
Cell[CellGroupData[{
Cell[1190, 39, 81, 1, 105, "Section"],
Cell[1274, 42, 1234, 29, 287, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2545, 76, 142, 2, 105, "Section"],
Cell[2690, 80, 44586, 1076, 2555, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47313, 1161, 97, 1, 105, "Section"],
Cell[CellGroupData[{
Cell[47435, 1166, 9980, 238, 773, "Input"],
Cell[57418, 1406, 19523, 399, 557, "Output"]
}, Open  ]],
Cell[76956, 1808, 662, 16, 71, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[77655, 1829, 152, 2, 105, "Section"],
Cell[77810, 1833, 200, 2, 43, "Input"],
Cell[CellGroupData[{
Cell[78035, 1839, 9143, 233, 746, "Input"],
Cell[87181, 2074, 21118, 429, 557, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[108348, 2509, 167, 2, 105, "Section"],
Cell[CellGroupData[{
Cell[108540, 2515, 819, 20, 152, "Input"],
Cell[109362, 2537, 1109, 30, 472, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[110508, 2572, 1033, 26, 233, "Input"],
Cell[111544, 2600, 747, 24, 52, "Print"],
Cell[112294, 2626, 1056, 28, 472, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
